services:
  server:
    build:
      context: .
    image: gdl-web-server:latest
    ports:
      - "${PORT:-6969}:6969"
    volumes:
      # Use named volumes instead of local folders
      - downloads:/app/downloads
      - cookies:/app/secure_cookies
    environment:
      - FLASK_ENV=${FLASK_ENV}
      # Removed hardcoded PORT so it can be inherited or default to internal
      - DOWNLOADS_DIR=/app/downloads
      - COOKIES_DIR=/app/secure_cookies
      # Secrets are loaded from .env file
      - COOKIES_ENCRYPTION_KEY=${COOKIES_ENCRYPTION_KEY}
      - SECRET_KEY=${SECRET_KEY}
    restart: always

# Define the persistent storage volumes
volumes:
  downloads:
  cookies: